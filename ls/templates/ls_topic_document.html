{% extends "frameWithTitle.html" %}

{% block content %}

	<div class="container" style="width: 980px">

		<div class="container-fluid" style="padding-left: 0px;padding-right: 0px;">
			<div class="row-fluid" >
				<div class="span9">
					<!-- main -->
					<div class="row-fluid">
						<div class="span8" >
							<h3 style='font-family: "Helvetica Neue",Arial,sans-serif'> {{topic.instance.title}}</h3>
						</div>
						<div class="span4" style="padding-top: 30px">
							<span style="float: right">类别：<a href="/cat/{{topic.getCategory.id}}/1">{{topic.getCategory.name}}</a></span>
							{% if user.is_staff %}
							{% endif %}
						</div>
					</div>
					<div class="row-fluid" style="border-top: 1px solid #dddddd; margin-bottom: 10px">
						<div class="span2" style="margin-top: 20px">
							<img
							class="img-rounded"
							alt="140x140"
							style="width: 60px; height: 60px;"
							src="http://static.lsapp.com/avatar/a_250X250_{{topic.instance.userid}}.jpg">
							</img>
						</div>
						<div  class="span10" style="margin-left: 0px">
							<div class="row-fluid">
								<div class="span12">
									<div class="row-fluid">
										<div class="span9">
											<h5><span >作者： {{doc.author_name}}</span></h5>
										</div>
										<div class="span3" style="height:30px;margin-top: 10px;">
											<span></span>
										</div>
									</div>
									<div class="row-fluid">
                                        <div class="span12">
                                            <span >发布： {{topic.instance.created_at|date:"Y-m-d f"}}</span></h5>
                                        </div>
                                     
                                    </div>
                                    <div class="row-fluid">
                                        <div class="span12">
                                            <span >更新： {{topic.instance.updated_at|date:"Y-m-d f"}}</span></h5>
                                        </div>
                                     
                                    </div>
                                    <div class="row-fluid">
                                        <div class="span12">
                                            状态：完结 
                                        </div>
                                    </div>
									<div class="row-fluid">
										<div class="span12">
											阅读：{{topic.instance.read_count}} 
										</div>
									</div>
                                    <div class="row-fluid">
                                        <div class="span12">
                                            章节：12
                                        </div>
                                    </div>
                                    <div class="row-fluid">
                                        <div class="span12">
                                            字数：12342155
                                        </div>
                                    </div>
                                    <div class="row-fluid">
                                        <div class="span12" style="height: 40px">
                                           <a href="{{doc.source_url}}" class="btn btn-primary">立即阅读</a>
                                           <span style="margin-left: 10px"><a href="{{doc.source_url}}" class="btn ">想看</a></span>
                                           <span style="margin-left: 10px">评分：
                                               <a class="badge badge-important"><i class="icon-heart icon-white"></i></a>
                                               <a class="badge badge-important"><i class="icon-heart icon-white"></i></a>
                                               <a class="badge badge-important"><i class="icon-heart icon-white"></i></a>
                                               <a class="badge badge-info"><i class="icon-heart icon-white"></i></a>
                                               <a class="badge badge-info"><i class="icon-heart icon-white"></i></a>
                                                       
                                           </span>
                                        </div>
                                    </div>
									<div class="row-fluid">
										<div class="span12">
											 <b>简介：</b>{{topic.instance.content|linebreaksbr}}
										</div>
									</div>
									<div class="row-fluid">
                                        <div class="span12">
                                            来自：<a href="{{doc.source_url}}">起点中文</a>
                                        </div>
                                    </div>
									{% if user.is_staff %}
									<div class="row-fluid" style="margin-bottom: -15px">
										<div class="span12">
											<span style="float:right">
												<a href="#">编辑</a>
												<a href="#">隐藏</a>
												<a href="#">删除</a>
											</span>
										</div>
									</div>
									{% endif %}
								</div>

							</div>
						</div>
					</div>
					
					
					{% for reply in reply_list%}
					<div class="row-fluid" style="border-top: 1px solid #dddddd;padding:10px 0px 10px 0px">
						<div class="span2" style="margin-top: 2px;margin-left: 10px">
							<img
							class="img-rounded"
							alt="140x140"
							style="width: 60px; height: 60px;"
							src="http://static.lsapp.com/avatar/a_250X250_{{reply.userid}}.jpg">
							</img>
						</div>
						<div  class="span10" style="margin-left: 0px">
							<div class="row-fluid">
								<div class="span12">
									<div class="row-fluid">
										<div class="span3">
											<h5 style="margin: 0px"><span >来自： {{reply.username}}</span></h5>
										</div>
										<div class="span3">
											<span style="margin-left: 10px">{{reply.created_at|date:"Y-m-d f"}}</span>
										</div>
										<div class="span6">
											<span  class="badge badge-info" style="float: right">{{reply.num}}</span>
										</div>	 
									</div>
									<div class="row-fluid" style="display:none">
										<div class="span12">
											{{reply.title}}
										</div>
									</div>
									<div class="row-fluid">
										<div class="span12">
											{{reply.content|linebreaksbr }}
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					{% endfor %}

					<!--翻页组建，需要PageInfo对象-->
					{% include 'base_util_pagination.html' %}
					
					<div id="newReply" class="hero-unit" data style="background:#FFFFFF; border: 1px solid #0088cc; margin:0px; padding:0px;display: none">
		
						<div class="row-fluid"  style="">
							<div class="span2" style="margin-top: 10px;margin-left: 10px">
								<img
								class="img-rounded"
								alt="140x140"
								style="width: 60px; height: 60px;"
								src="http://static.lsapp.com/avatar/a_250X250_{{user.id}}.jpg">
								</img>
							</div>
							<div  class="span10" style="margin-left: 0px">
								<div class="row-fluid">
									<div class="span12">
										<div class="row-fluid">
											<div class="span12 ">

												<button type="button" class="close" onclick="toggleReplyForm();" >
													&times;
												</button>

												<h5><span >来自： {{user.username}}</span>
													<span style="margin: 10px  10px 0px 0px;" id='new-reply-time'>{{reply.created_at|date:"Y-m-d f"}}</span>
													<span class="label label-success">NEW</span>
												</h5>
											
											</div>
										</div>
										<div class="row-fluid" style="display: none">
											<div class="span12">
												{{reply.title}}
											</div>
										</div>
										<div class="row-fluid">
											<div class="span12" id='new-reply-content'>
												{{reply.content|linebreaks}}
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						
					</div>

					{% if user.is_active %}
					<div class="row-fluid"  style="margin-top: 5px;padding-top: 10px" id='reply-form-div'>
						<div class="span2" style="margin-top: 0px;padding-left: 10px">
							<img
							class="img-rounded"
							alt="140x140"
							style="width: 60px; height: 60px;"
							src="http://static.lsapp.com/avatar/a_250X250_{{user.id}}.jpg">
							</img>
						</div>
						<div class='span10' >
							<form class="form" method="post" id="postTopicReply" onsubmit="return postTopicReply();">
								{% csrf_token %}
								<div class="control-group">

									<div class="controls">
										<textarea rows="3" name="replyContent" style='width: 590px' onclick="cleanArea()">评论内容</textarea>
									</div>
								</div>

								<div class="control-group">
									<div class="controls">
										<button type="submit" class="btn btn-primary">
											提交评论
										</button>
									</div>
								</div>
							</form>
						</div>
					</div>
					<script>
						function cleanArea(){
							val=$('#reply-form-div textarea').val();
							if(val=='评论内容'){
								$('#reply-form-div textarea').val('');
							}
						}
						function toggleReplyForm(){
							$('#newReply').fadeOut(
								function(){
									$('#reply-form-div').fadeIn('slow');
									$('#reply-form-div textarea').val('评论内容');
								});
						}
						function postTopicReply() {
							$.post("/topic/{{topic.instance.id}}/add_reply", $("#postTopicReply").serialize()).done(function(data) {
								if (data['success'] == 'false') {
									str = ''
									for (key in data['errors']) {
										str += (key + '=' + data[key] + '\n');
									}
									alert(str)

								} else {
									$('#new-reply-time').html(data['time']);
									$('#new-reply-content').html(data['content']);
									$('#reply-form-div').fadeOut(function(){
										$('#newReply').fadeIn('show');
									});
									

								}
							});
							return false;
							//不提交页面
						}

					</script>
					{% endif %}
				</div>
				<div class="span3">
					<!--Sidebar content-->
					<div class="row-fluid">
						<div class="span12">

							<ul class="nav nav-list">
								<li class="nav-header">
									同类热门小说：
								</li>
								{% for doc in hot_docs %}

								<li>
									<span><a href="{{doc.source_url}}" target='_blank' style="font-size: 16px">{{doc.topic.title}}</a> 阅读：{{doc.topic.read_count}}</span>
								</li>
								{% endfor %}
							</ul>
						</div>
					</div>
					<div class="row-fluid">
						{% for uf in follows %}
						<div class="span4">
							<img
							class="img-rounded"
							alt="140x140"
							style="width: 50px; height: 50px;"
							src="http://static.lsapp.com/avatar/a_250X250_{{uf.followed_userid}}.jpg">
							</img>
						</div>
						{% endfor%}
					</div>

				</div>
			</div>

		</div>
	</div>

{% endblock %}
