{% extends "mframe.html" %}

{% block page %}

<section data-role='page' id='id_doc_main'>
    <header data-role='header'>
        <a data-rel='back'>返回</a>
        <h1>{{ topic.instance.title }}</h1>
    </header>
    <div data-role='content' style="padding: 0px 15px 15px 15px;">
        <p>阅读数：
            {{ topic.instance.read_count }}
        </p>
        <p>最后更新：
            {{ topic.instance.getDocument.source_updated_at|date:"Y-m-d" }}
        </p>
        <ul data-role='listview'>
            <li data-role='list-divider'>内容简介：</li>
        </ul>

        <p>
            {% autoescape off %}
                {{ topic_content|linebreaksbr }}
            {% endautoescape %}
        </p>
        <ul data-role='listview' id='id_catalogs'>
           <li data-role='list-divider'>章节：</li>
            {% for chapter in chapters %}
                {% if chapter.title %}
                    <li>
                        <a href='/m/topic/{{ topic.instance.id }}/reply/{{chapter.id}}' >{{ chapter.title }}</a>
                    </li>
                {% endif  %}

            {% endfor %}
        </ul>
    </div>
    <footer data-role='footer'><a href='{{ topic.instance.getDocument.source_url }}' style="float: right">访问源网页</a></footer>
</section>
<div data-role='page' id='id_shortcut'>
        <div data-role='header'><h4>快捷菜单</h4></div>
        <div data-role='content'>
                <a data-role='button'>到顶部</a>
                <a data-role='button'>加书签</a>
                <a data-role='button'>到页尾</a>
                <a data-role='button'>到目录</a>
        </div>
</div>
<script type='text/javascript'>
    $('#id_doc_main').on('pageshow',function(){
        catalogs_top = $('#id_catalogs').offset()['top'];
        $.mobile.silentScroll(catalogs_top);

    });
    var cbtn; //快捷按钮
    var cpage; //当前page
    var prepPage=function(event,ui){

        np=$(ui.nextPage[0]);
        np.on('pagehide',prepPage);
        cpage=np;

        reply_id=np.attr('reply_id');
        btn=$('#id_fast_btn_'+reply_id);
        btn.css('bottom','-8px');
        btn.css('right','0px');
        //btn.show();
        //cbtn=btn;

    };
    $(window).on('scrollstop',function(){
        if(cbtn){
            if((cpage.height()-$(document).scrollTop())<($(window).height()*2)){
                cbtn.hide();
            }else{
                cbtn.show();
            };


        }

    })

    $('#id_doc_main').on('pagehide',prepPage);
</script>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F61ed06e0d1504327fa7ef3da349056b5' type='text/javascript'%3E%3C/script%3E"));
</script>

{% endblock %}
